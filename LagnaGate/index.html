<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù„Ø¬Ø§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª - Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø«ØºØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©">
    <title>Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø«ØºØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© - Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù„Ø¬Ø§Ù†</title>
    
    <!-- Favicon: Ministry Logo -->
    <link rel="icon" type="image/png" href="education_ministry.PNG">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e',
                        }
                    },
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'shimmer': 'shimmer 2s infinite linear'
                    },
                    keyframes: {
                        'shake': {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        'shimmer': {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Tajawal', sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        .skeleton {
            background: #1f2937;
            background-image: linear-gradient(to right, #1f2937 0%, #374151 20%, #1f2937 40%, #1f2937 100%);
            background-repeat: no-repeat;
            background-size: 800px 104px;
            animation: shimmer 1.5s infinite linear forwards;
        }
        @media (max-width: 768px) { .skeleton { height: auto !important; min-height: 80px; } }
        @media print {
            @page { size: A4 portrait; margin: 0; }
            body { background: #fff !important; color: #000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; margin: 0 !important; padding: 10mm 0 !important; display: flex !important; justify-content: center !important; align-items: flex-start !important; width: 100% !important; min-height: 100vh !important; }
            .no-print { display: none !important; }
            #result-section { display: block !important; opacity: 1 !important; visibility: visible !important; width: 210mm !important; max-width: 100% !important; }
            #student-card { width: 190mm !important; margin: 0 auto !important; box-shadow: none !important; border: 2px solid #000 !important; page-break-inside: avoid; transform: scale(1); }
            #student-card .grid { display: grid !important; grid-template-columns: repeat(3, minmax(0, 1fr)) !important; gap: 1.5rem !important; }
            #student-card .md\:col-span-2 { grid-column: span 2 / span 2 !important; }
            #student-card .p-6 { padding: 1.5rem !important; }
            .dark\:bg-gray-800, .dark\:bg-gray-900 { background: white !important; }
            .dark\:text-gray-100, .dark\:text-brand-300, .dark\:text-brand-400 { color: black !important; }
            .dark\:border-gray-700 { border-color: #000 !important; }
            .table-border { border: 1px solid #000 !important; }
            .table-header { background-color: #f3f4f6 !important; color: #000 !important; }
            .print-list { list-style-type: none !important; padding-right: 0 !important; }
        }
        #pdf-clone-container { position: fixed; top: -9999px; left: 0; z-index: -1; }
        .pdf-card-style { width: 200mm !important; margin: 0 auto !important; padding: 10mm !important; background-color: white !important; color: black !important; border: 2px solid #000 !important; direction: rtl; font-family: 'Tajawal', sans-serif; }
        .pdf-card-style .grid { display: grid !important; grid-template-columns: repeat(3, minmax(0, 1fr)) !important; }
        .pdf-card-style .md\:col-span-2 { grid-column: span 2 / span 2 !important; }
        .pdf-school-name { font-size: 1.25rem !important; font-weight: 800 !important; margin-top: 5px !important; }
        .pdf-card-style .print-list { list-style-type: none !important; padding-right: 0 !important; }
        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { pointer-events: auto; padding: 12px 24px; border-radius: 99px; background: rgba(255, 255, 255, 0.95); color: #1f2937; font-size: 0.9rem; font-weight: 500; box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 10px; animation: toastFadeIn 0.3s ease-out; backdrop-filter: blur(4px); }
        .toast-success i { color: #4ade80; }
        .toast-error i { color: #f87171; }
        .toast-info i { color: #60a5fa; }
        @keyframes toastFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .util-btn { transition: all 0.2s ease; }
        .util-btn:hover { transform: translateY(-2px); }
        .util-btn:active { transform: translateY(0) scale(0.98); }
        .util-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .loader-spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .input-error { background-color: #450a0a !important; border-color: #f87171 !important; color: #fca5a5 !important; }
        .clear-btn { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af; cursor: pointer; padding: 4px; border-radius: 50%; transition: all 0.2s; }
        .clear-btn:hover { color: #ef4444; background-color: rgba(239, 68, 68, 0.1); }
        .custom-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .custom-table th, .custom-table td { border: 1px solid #4b5563; padding: 8px; text-align: center; }
        .custom-table th { background-color: #374151; color: white; font-weight: bold; }
        .print-list { list-style-type: disc; list-style-position: inside; padding-right: 0.5rem; margin: 0; text-align: right; font-size: 0.8rem; line-height: 1.5; }
        .print-list li { margin-bottom: 4px; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

    <header class="w-full py-4 md:py-6 no-print bg-gray-900">
        <div class="container mx-auto px-6 flex items-center justify-center md:justify-between">
            <div class="flex flex-col md:flex-row items-center gap-0 md:gap-4 select-none w-full md:w-auto" role="banner">
                <img src="education_ministry.PNG" alt="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" class="h-32 md:h-48 w-auto object-contain flex-shrink-0" onerror="this.style.display='none'">
                <div class="flex flex-col items-center md:items-start md:border-r-2 border-gray-700 md:pr-4 -mt-4 md:mt-0">
                    <h1 class="text-xl md:text-3xl font-black text-white tracking-tight leading-tight text-center md:text-right">
                        Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø«ØºØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©
                    </h1>
                    <span class="text-brand-600 font-bold text-base md:text-xl mt-1 text-center md:text-right">
                        Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…ØªÙˆØ³Ø·
                    </span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 flex flex-col items-center justify-start gap-8 pt-4 md:pt-12" role="main">
        <section id="search-section" class="w-full max-w-md transition-all duration-500 no-print" aria-label="Ø§Ù„Ø¨Ø­Ø«">
            <div class="bg-gray-800 rounded-[2rem] shadow-none p-6 md:p-8 border border-gray-700">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold mb-3 text-white">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</h2>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù„Ø¬Ù†Ø© ÙˆØ§Ù„Ù…Ù‚Ø¹Ø¯
                    </p>
                </div>
                <div class="relative group mb-5">
                    <label for="search-input" class="sr-only">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                    <input type="text" id="search-input" class="block w-full px-4 py-3 text-xl font-bold text-center border-2 border-gray-600 rounded-2xl focus:ring-0 focus:border-brand-500 bg-gray-900/50 text-white transition-all tracking-[0.2em] placeholder-gray-600 outline-none" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" maxlength="10" autocomplete="off" inputmode="numeric" aria-required="true" aria-controls="result-section">
                    <button type="button" id="clear-btn" class="clear-btn hidden" aria-label="Ù…Ø³Ø­ Ø§Ù„Ù†Øµ"><i class="fas fa-times text-lg"></i></button>
                </div>
                <button id="search-btn" class="util-btn w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3.5 px-6 rounded-2xl shadow-none flex justify-center items-center gap-3 text-base transition-all">
                    <span id="btn-text">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</span><i id="btn-icon" class="fas fa-arrow-left"></i>
                </button>
            </div>
        </section>

        <div id="skeleton-loader" class="w-full max-w-2xl hidden opacity-0 transition-opacity" aria-hidden="true">
            <div class="bg-gray-800 rounded-3xl shadow-sm p-8 space-y-4">
                <div class="skeleton h-24 w-full rounded-2xl"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="skeleton h-12 rounded-xl"></div>
                    <div class="skeleton h-12 rounded-xl"></div>
                </div>
                <div class="skeleton h-32 w-full rounded-2xl"></div>
            </div>
        </div>

        <section id="result-section" class="w-full max-w-2xl hidden opacity-0 transition-opacity duration-500" aria-live="polite" role="region" aria-label="Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø«" lang="ar">
            <div id="student-card" class="bg-gray-800 rounded-3xl shadow-xl overflow-hidden border border-gray-700 relative">
                <div class="bg-white p-4 border-b-4 border-brand-600 flex items-center justify-between">
                    <div class="flex flex-col text-right">
                        <h2 class="text-black font-bold text-lg leading-tight">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø«ØºØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ Ø¨Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠØ©</h2>
                        <span class="text-brand-600 font-bold text-sm">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…ØªÙˆØ³Ø·</span>
                    </div>
                    <img src="education_ministry.PNG" alt="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…" class="h-16 w-auto object-contain" onerror="this.style.display='none'">
                </div>
                <div class="p-6 md:p-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="md:col-span-2 space-y-4">
                            <div class="bg-gray-700/30 p-3 rounded-lg border border-gray-600">
                                <label class="block text-xs font-bold text-gray-400 mb-1">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                                <div id="res-name" class="text-lg font-bold text-white"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                                    <div id="res-id" class="font-mono font-semibold text-brand-400 text-base"></div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„ØµÙ</label>
                                    <div id="res-grade" class="font-semibold text-white text-base"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„Ø¯ÙˆØ±</label>
                                    <div id="res-class" class="font-semibold text-white text-base"></div>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ø³Ù… Ø§Ù„Ù„Ø¬Ù†Ø©</label>
                                    <div id="res-committee-no" class="font-bold text-brand-300 text-lg"></div>
                                </div>
                            </div>
                            <div class="bg-gray-700/30 p-3 rounded-lg border border-gray-600 mt-2">
                                 <label class="block text-xs font-bold text-gray-400 mb-1 flex items-center gap-2"><i class="fas fa-map-marker-alt"></i> Ù…Ù‚Ø± Ø§Ù„Ù„Ø¬Ù†Ø©</label>
                                 <div id="res-location" class="font-bold text-white text-base"></div>
                            </div>
                        </div>
                        <div class="flex flex-col items-center justify-center gap-4 bg-white rounded-xl p-4 border-2 border-brand-600">
                            <label class="text-sm font-bold text-black uppercase">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³</label>
                            <div id="res-seat" class="text-5xl font-extrabold text-brand-600"></div>
                            <div id="qrcode" class="mt-2"></div>
                            <div id="qr-text-display" class="text-xs font-mono font-bold text-black" style="direction: ltr;"></div>
                        </div>
                    </div>
                    <div class="border-t-2 border-gray-600 pt-4 mt-2">
                        <div class="text-center mb-3">
                            <h3 class="text-brand-400 font-bold text-lg">Ø¬Ø¯ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø¹Ø§Ù… Ù¡Ù¤Ù¤Ù§Ù‡Ù€</h3>
                            <p class="text-gray-400 text-xs" dir="rtl" style="direction: rtl; unicode-bidi: embed;">Ù„Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø· - Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø· - Ø§Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</p>
                        </div>
                        <table class="custom-table text-gray-200 w-full mb-4">
                            <thead>
                                <tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø²Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>Ø§Ù„Ø£Ø­Ø¯</td><td>Ù¡Ù¥-Ù§-Ù¡Ù¤Ù¤Ù§Ù‡Ù€</td><td>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</td><td>Ù§:Ù£Ù  - Ù¡Ù :Ù Ù </td></tr>
                                <tr><td>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</td><td>Ù¡Ù¦-Ù§-Ù¡Ù¤Ù¤Ù§Ù‡Ù€</td><td>Ù„ØºØªÙŠ</td><td>Ù§:Ù£Ù  - Ù¡Ù :Ù Ù </td></tr>
                                <tr><td>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</td><td>Ù¡Ù§-Ù§-Ù¡Ù¤Ù¤Ù§Ù‡Ù€</td><td>Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ</td><td>Ù§:Ù£Ù  - Ù©:Ù£Ù </td></tr>
                                <tr><td>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</td><td>Ù¡Ù¨-Ù§-Ù¡Ù¤Ù¤Ù§Ù‡Ù€</td><td>Ø¹Ù„ÙˆÙ…</td><td>Ù§:Ù£Ù  - Ù©:Ù£Ù </td></tr>
                            </tbody>
                        </table>
                        <div class="bg-gray-800 border border-gray-600 p-3 rounded-lg">
                            <h4 class="text-brand-400 font-bold text-sm mb-2 underline">ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù‡Ø§Ù…Ø©:</h4>
                            <ul class="print-list text-gray-300 text-xs space-y-1 pr-4" dir="rtl">
                                <li>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ØªØ´Ù…Ù„ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø· ÙÙ‚Ø·ØŒ Ø¨ÙŠÙ†Ù…Ø§ ØªÙ… Ø¥Ø¹ÙØ§Ø¡ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ ÙˆØ³ØªÙƒÙˆÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù….</li>
                                <li>Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ù…Ø¨ÙƒØ± Ù‚Ø¨Ù„ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆÙ‚Øª ÙƒØ§ÙÙ Ù…Ø¹ Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ø§Ù„Ø²ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ (Ø§Ù„Ø«ÙˆØ¨).</li>
                                <li>ÙŠÙ…Ù†Ø¹ Ø¥Ø­Ø¶Ø§Ø± Ø§Ù„Ø¬ÙˆØ§Ù„ØŒ ÙˆØ¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§ÙÙ‡ Ù…Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø© Ø§Ù„Ø¥Ù…ØªØ­Ø§Ù† ÙØ³ÙŠØªÙ… ØªØ­Ø±ÙŠØ± Ù…Ø­Ø¶Ø± ØºØ´.</li>
                                <li>Ø§Ù„ØªÙ‚ÙŠØ¯ Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±.</li>
                                <li>Ø­Ø³Ø¨ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©ØŒ Ù„Ø§ ÙŠÙØ¹Ø§Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØºØ§Ø¦Ø¨ Ø¥Ù„Ø§ Ø¨Ø¹Ø°Ø± ØªÙ‚Ø¨Ù„Ù‡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.</li>
                                <li>Ø¥Ø­Ø¶Ø§Ø± Ù‚Ù„Ù… Ø±ØµØ§Øµ (HB2) Ø§Ù„Ø®Ø§Øµ Ø¨ØªØ¸Ù„ÙŠÙ„ Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©.</li>
                                <li>Ø³ÙŠØªÙ… Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù…Ø´ÙŠØ¦Ø© Ø§Ù„Ù„Ù‡ ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³ Ø§Ù„Ù…ÙˆØ§ÙÙ‚ Ù¡Ù©-Ù§-Ù¡Ù¤Ù¤Ù§Ù‡Ù€.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="hidden print:block text-center text-xs text-gray-400 p-2 border-t italic">
                    ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ - Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø«ØºØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ
                </div>
            </div>
            <div class="flex flex-wrap gap-4 mt-8 justify-center no-print">
                <button id="print-btn" onclick="window.print()" class="util-btn flex-1 bg-gray-900 hover:bg-black text-white py-3.5 px-6 rounded-2xl shadow-lg flex justify-center items-center gap-2 font-bold transition-transform hover:-translate-y-1" disabled aria-label="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
                    <i class="fas fa-print"></i> <span>Ø·Ø¨Ø§Ø¹Ø©</span>
                </button>
                <button onclick="downloadPDF()" class="util-btn flex-1 bg-red-600 hover:bg-red-700 text-white py-3.5 px-6 rounded-2xl shadow-lg shadow-red-200 dark:shadow-none flex justify-center items-center gap-2 font-bold transition-transform hover:-translate-y-1" aria-label="Ø­ÙØ¸ ÙƒÙ…Ù„Ù PDF">
                    <i class="fas fa-file-pdf"></i> <span>PDF</span>
                </button>
                <button onclick="UIService.resetSearch()" class="util-btn flex-1 bg-white hover:bg-gray-50 text-gray-700 border border-gray-200 dark:bg-gray-800 dark:border-gray-700 dark:text-white py-3.5 px-6 rounded-2xl shadow-sm flex justify-center items-center gap-2 font-bold transition-transform hover:-translate-y-1" aria-label="Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯">
                    <i class="fas fa-undo"></i> <span>Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</span>
                </button>
            </div>
        </section>
    </main>

    <div id="pdf-clone-container"></div>
    <footer class="py-6 mt-auto no-print border-t border-gray-800">
        <div class="container mx-auto px-4 text-center text-xs text-gray-600 font-medium"><span>Â© 2025 Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø«ØºØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span></div>
    </footer>
    <div id="toast-container"></div>

    <script>
        const CONFIG = {
            CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSVUh9_yERMZ-jsnw3M9RjSJKF4SCg1DFV1uIPgU5kxtzSAmS8J61NC9kJuUBtQRiNKJWu4jpmW7hn7/pub?gid=0&single=true&output=csv',
            CACHE_KEY: 'thaghr_data_live_v13',
            CACHE_EXPIRY: 60 * 60 * 1000
        };

        const els = {
            searchInput: document.getElementById('search-input'),
            searchBtn: document.getElementById('search-btn'),
            clearBtn: document.getElementById('clear-btn'),
            btnText: document.getElementById('btn-text'),
            btnIcon: document.getElementById('btn-icon'),
            resultSection: document.getElementById('result-section'),
            skeletonLoader: document.getElementById('skeleton-loader'),
        };

        let studentsData = [];

        // DATA SERVICE
        const DataService = {
            studentsMap: new Map(),

            getData: async () => {
                UIService.setLoading(true);
                try {
                    return await DataService.fetchFreshData();
                } catch (err) {
                    throw err;
                } finally {
                    UIService.setLoading(false);
                }
            },

            fetchFreshData: async (retries = 3) => {
                for (let i = 0; i < retries; i++) {
                    try {
                        return await new Promise((resolve, reject) => {
                            if (!navigator.onLine) {
                                reject('CONNECTION_ERROR');
                                return;
                            }
                            const liveUrl = `${CONFIG.CSV_URL}&t=${Date.now()}`;
                            
                            Papa.parse(liveUrl, {
                                download: true,
                                header: true,
                                skipEmptyLines: true,
                                complete: (results) => {
                                    if (results.data?.length) {
                                        const cleanData = results.data
                                            .map(row => DataService.normalizeRow(row))
                                            .filter(s => s.id && s.id !== '---' && s.id.length >= 9);
                                        if (cleanData.length === 0) { reject('DATA_ERROR'); return; }
                                        DataService.hydrateMap(cleanData);
                                        resolve(true);
                                    } else { reject('DATA_ERROR'); }
                                },
                                error: () => reject('CONNECTION_ERROR')
                            });
                        });
                    } catch (e) {
                        if (i === retries - 1) throw e;
                        await new Promise(r => setTimeout(r, 800));
                    }
                }
            },

            hydrateMap: (dataArray) => {
                DataService.studentsMap.clear();
                dataArray.forEach(student => {
                    DataService.studentsMap.set(student.id, student);
                });
            },

            normalizeRow: (row) => {
                const rowKeys = Object.keys(row);
                const getVal = (keywords, exclude = []) => {
                    const matchKey = rowKeys.find(key => {
                        const cleanKey = key.trim().toLowerCase();
                        if (exclude.some(ex => cleanKey.includes(ex.toLowerCase()))) return false;
                        return keywords.some(kw => cleanKey.includes(kw.toLowerCase()));
                    });
                    return matchKey ? (row[matchKey] + '').trim() : '---';
                };
                return {
                    school: getVal(['Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©', 'Ù…Ø¯Ø±Ø³Ø©', 'school']),
                    id: getVal(['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ù‡ÙˆÙŠØ©', 'id', 'national', 'Ø³Ø¬Ù„']),
                    name: getVal(['Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨', 'name', 'student'], ['Ù…Ø¯Ø±Ø³Ø©', 'school']),
                    grade: getVal(['Ø§Ù„ØµÙ', 'grade', 'level', 'Ù…Ø³ØªÙˆÙ‰']),
                    class: getVal(['Ø§Ù„Ø¯ÙˆØ±', 'class', 'ÙØµÙ„', 'Ø´Ø¹Ø¨Ø©']),
                    committee: getVal(['Ø§Ù„Ù„Ø¬Ù†Ø©', 'Ø§Ø³Ù… Ø§Ù„Ù„Ø¬Ù†Ø©', 'committee', 'comm']),
                    location: getVal(['Ù…Ù‚Ø± Ø§Ù„Ù„Ø¬Ù†Ø©', 'Ù…Ù‚Ø±', 'location', 'Ù…ÙƒØ§Ù†']),
                    seat: getVal(['Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³', 'Ø¬Ù„ÙˆØ³', 'seat', 'Ù…Ù‚Ø¹Ø¯'])
                };
            },

            findStudent: (id) => {
                return DataService.studentsMap.get(id);
            }
        };

        // UI SERVICE
        const UIService = {
            setLoading: (isLoading) => {
                if (isLoading) {
                    els.btnText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
                    els.btnIcon.className = 'fas fa-sync-alt loader-spin';
                    els.searchBtn.disabled = true;
                    els.skeletonLoader.classList.remove('hidden', 'opacity-0');
                    els.resultSection.classList.add('hidden');
                } else {
                    els.btnText.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©';
                    els.btnIcon.className = 'fas fa-arrow-left';
                    els.searchBtn.disabled = false;
                    els.skeletonLoader.classList.add('opacity-0');
                    setTimeout(() => els.skeletonLoader.classList.add('hidden'), 300);
                }
            },

            triggerInputError: () => {
                els.searchInput.classList.add('animate-shake', 'input-error');
                setTimeout(() => els.searchInput.classList.remove('animate-shake'), 500);
            },

            showToast: (message, type = 'info') => {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                let icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-times-circle' : 'fa-info-circle';
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `<i class="fas ${icon}"></i> <span>${message}</span>`;
                container.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(10px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },

            renderResult: (s) => {
                const fields = {
                    'res-school': s.school !== '---' ? s.school : '',
                    'res-name': s.name,
                    'res-id': s.id,
                    'res-grade': s.grade,
                    'res-class': s.class,
                    'res-committee-no': s.committee,
                    'res-location': s.location,
                    'res-seat': s.seat
                };

                for (const [id, val] of Object.entries(fields)) {
                    const el = document.getElementById(id);
                    if (el) el.textContent = val || '---';
                }

                document.getElementById('print-btn')?.removeAttribute('disabled');

                const qrContainer = document.getElementById('qrcode');
                qrContainer.innerHTML = '';
                const qrSize = window.innerWidth < 400 ? 110 : 130;
                new QRCode(qrContainer, {
                    text: `ID:${s.id}\nSeat:${s.seat}`,
                    width: qrSize, height: qrSize,
                    colorDark : "#000000", colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.L
                });

                const qrDisplay = document.getElementById('qr-text-display');
                if (qrDisplay) qrDisplay.textContent = `${s.id} | ${s.seat}`;

                els.resultSection.classList.remove('hidden');
                setTimeout(() => els.resultSection.classList.remove('opacity-0'), 50);
                els.resultSection.scrollIntoView({ behavior: 'smooth' });
            },

            resetSearch: () => {
                els.resultSection.classList.add('opacity-0');
                document.getElementById('print-btn')?.setAttribute('disabled', 'true');
                setTimeout(() => {
                    els.resultSection.classList.add('hidden');
                    els.searchInput.value = '';
                    els.searchInput.focus();
                }, 300);
            }
        };

        // APP CONTROLLER
        const App = {
            init: () => {
                document.documentElement.className = 'dark';
                App.setupListeners();
                els.searchInput.focus();
            },
            setupListeners: () => {
                els.searchInput.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '');
                    els.searchInput.classList.remove('input-error');
                    els.clearBtn.classList.toggle('hidden', e.target.value.length === 0);
                });
                els.searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') App.handleSearch();
                });
                els.searchBtn.addEventListener('click', App.handleSearch);
                els.clearBtn.addEventListener('click', () => {
                    els.searchInput.value = '';
                    els.searchInput.focus();
                    els.clearBtn.classList.add('hidden');
                });
            },
            handleSearch: async () => {
                const query = els.searchInput.value.trim();
                if (!query || query.length !== 10) {
                    UIService.triggerInputError();
                    UIService.showToast('Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…', 'info');
                    return;
                }
                try {
                    await DataService.getData();
                    const student = DataService.findStudent(query);
                    if (student) {
                        UIService.renderResult(student);
                    } else {
                        UIService.showToast('Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
                    }
                } catch (err) {
                    if (err === 'CONNECTION_ERROR') UIService.showToast('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                    else UIService.showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©', 'error');
                }
            }
        };

        document.addEventListener('DOMContentLoaded', App.init);

        window.downloadPDF = () => {
            const original = document.getElementById('student-card');
            const clone = original.cloneNode(true);
            
            // --- FIX FOR PDF COLORS ---
            clone.style.backgroundColor = '#ffffff';
            clone.style.color = '#000000';
            clone.style.borderColor = '#000000';
            clone.classList.remove('dark:bg-gray-800', 'dark:border-gray-700', 'bg-gray-800', 'border-gray-700');
            
            const header = clone.querySelector('.bg-white');
            if (header) {
                header.classList.remove('border-b-4');
                header.style.borderBottom = '3px solid #0284c7';
            }

            clone.querySelectorAll('*').forEach(el => {
                 el.classList.remove('dark:text-white', 'text-white', 'dark:text-gray-100', 'text-gray-100', 'dark:text-gray-400', 'text-gray-400', 'text-gray-200', 'text-gray-300');
                 if (el.classList.contains('text-brand-600') || el.classList.contains('text-brand-400') || el.classList.contains('text-brand-300')) {
                     el.style.color = '#0284c7'; 
                 } else {
                     el.style.color = '#000000'; 
                 }
            });
            
            clone.querySelectorAll('.custom-table th').forEach(th => {
                th.style.backgroundColor = '#374151';
                th.style.color = '#ffffff';
            });

            clone.querySelectorAll('.custom-table td').forEach(td => {
                td.style.color = '#000000';
                td.style.borderColor = '#4b5563';
            });
            
            clone.querySelectorAll('i').forEach(icon => icon.style.color = '#000000');
            
            const darkContainers = clone.querySelectorAll('.bg-gray-700\\/30, .bg-gray-800');
            darkContainers.forEach(el => {
                el.style.backgroundColor = 'transparent';
                el.style.border = '1px solid #ddd';
                el.classList.remove('bg-gray-700/30', 'bg-gray-800');
            });
            
            const instrBox = clone.querySelectorAll('.bg-gray-800.border-gray-600, .bg-gray-700\\/50');
            instrBox.forEach(el => {
                 el.style.backgroundColor = 'transparent';
                 el.style.border = '1px solid #000';
                 el.classList.remove('bg-gray-800', 'border-gray-600', 'bg-gray-700/50', 'backdrop-blur-sm');
            });
            
            clone.querySelectorAll('img').forEach(img => {
                if(img.style.display === 'none') img.remove();
                else img.style.display = 'block'; 
            });
            
            const list = clone.querySelector('.print-list');
            if (list) {
                list.style.listStyleType = 'none';
                list.style.paddingRight = '0';
            }

            clone.classList.add('pdf-card-style'); 
            
            const container = document.getElementById('pdf-clone-container'); 
            container.innerHTML=''; 
            container.appendChild(clone);

            UIService.showToast('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©...', 'info');
            
            const pdfOptions = {
                margin: [10, 10],
                filename: `Exam_Card_${els.searchInput.value}.pdf`,
                image: { type: 'jpeg', quality: 0.95 },
                html2canvas: { 
                    scrollY: 0,
                    scale: 1.5,
                    useCORS: true,
                    width: clone.offsetWidth 
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(pdfOptions).from(clone).save().catch(err => {
                console.error(err);
                UIService.showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF', 'error');
            }).then(() => {
                container.innerHTML = '';
                UIService.showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸', 'success');
            });
        };
    </script>
</body>
</html>
